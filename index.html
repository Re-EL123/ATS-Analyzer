<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATS-Friendly CV Analyzer | Professional Resume Optimization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Professional Color Palette */
            --primary: #2563EB;
            --primary-dark: #1E40AF;
            --primary-light: #60A5FA;
            --secondary: #8B5CF6;
            --secondary-light: #A78BFA;
            --success: #10B981;
            --success-light: #34D399;
            --warning: #F59E0B;
            --warning-light: #FBBF24;
            --danger: #EF4444;
            --danger-light: #F87171;
            --info: #3B82F6;
            
            /* Neutral Colors */
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            
            /* Glass Effects */
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.4);
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }

        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(37, 99, 235, 0.4),
                            0 0 40px rgba(37, 99, 235, 0.15);
            }
            50% { 
                box-shadow: 0 0 30px rgba(37, 99, 235, 0.6),
                            0 0 60px rgba(37, 99, 235, 0.25);
            }
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes slide-up {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scale-in {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 25%, #8B5CF6 75%, #EC4899 100%);
            background-size: 200% 200%;
            animation: gradient-shift 20s ease infinite;
            min-height: 100vh;
            padding: 20px;
            color: var(--gray-900);
            overflow-x: hidden;
        }

        .background-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.08;
            pointer-events: none;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 255, 255, 0.3) 0%, transparent 50%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: slide-up 0.6s ease-out;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 12px;
            font-weight: 800;
            letter-spacing: -1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.2);
        }

        .header-icon {
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }

        .subtitle {
            font-size: 1.25rem;
            opacity: 0.95;
            font-weight: 400;
            text-shadow: 0 1px 10px rgba(0, 0, 0, 0.15);
        }

        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow-2xl),
                        0 0 0 1px rgba(255, 255, 255, 0.15) inset;
            margin-bottom: 24px;
            animation: scale-in 0.5s ease-out;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.25),
                        0 0 0 1px rgba(255, 255, 255, 0.15) inset;
        }

        .upload-area {
            border: 3px dashed rgba(255, 255, 255, 0.5);
            border-radius: 16px;
            padding: 60px 24px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.25), transparent);
            transition: left 0.5s;
        }

        .upload-area:hover::before {
            left: 100%;
        }

        .upload-area:hover {
            border-color: var(--primary-light);
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.02);
            box-shadow: 0 10px 40px rgba(37, 99, 235, 0.3);
        }

        .upload-area.dragover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.15);
            transform: scale(1.05);
            animation: pulse-glow 1.5s ease-in-out infinite;
        }

        .upload-icon-container {
            display: inline-block;
            animation: float 3s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.3rem;
            color: var(--gray-900);
            margin-bottom: 12px;
            font-weight: 700;
        }

        .upload-hint {
            color: var(--gray-700);
            font-size: 0.95rem;
            font-weight: 500;
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 18px 36px;
            border-radius: 12px;
            font-size: 1.05rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-weight: 700;
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.3px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(37, 99, 235, 0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: linear-gradient(135deg, var(--gray-400) 0%, var(--gray-500) 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.6;
        }

        .processing {
            display: none;
            text-align: center;
            padding: 60px 32px;
        }

        .spinner-container {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
        }

        .spinner {
            position: absolute;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
        }

        .spinner-inner {
            position: absolute;
            border: 5px solid rgba(255, 255, 255, 0.15);
            border-bottom: 5px solid var(--secondary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            top: 10px;
            left: 10px;
            animation: spin 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite reverse;
        }

        .processing h3 {
            font-size: 1.6rem;
            margin-bottom: 12px;
            color: var(--gray-900);
            font-weight: 700;
        }

        .processing-text {
            color: var(--gray-700);
            font-size: 1.05rem;
            font-weight: 500;
        }

        .results {
            display: none;
        }

        .score-circle-container {
            position: relative;
            width: 260px;
            height: 260px;
            margin: 0 auto 40px;
        }

        .score-circle {
            width: 260px;
            height: 260px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: conic-gradient(
                var(--score-color) calc(var(--score) * 1%), 
                rgba(255, 255, 255, 0.25) 0
            );
            animation: scale-in 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2),
                        0 0 0 1px rgba(255, 255, 255, 0.15) inset;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.92) 100%);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.12) inset;
        }

        .score-icon-bg {
            position: absolute;
            top: 25px;
            right: 25px;
            animation: float 2.5s ease-in-out infinite;
        }

        .score-value {
            font-size: 4rem;
            font-weight: 900;
            z-index: 1;
            color: var(--gray-900);
            letter-spacing: -3px;
        }

        .score-label {
            font-size: 1.05rem;
            color: var(--gray-600);
            z-index: 1;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .score-rating {
            text-align: center;
            font-size: 1.75rem;
            font-weight: 800;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            animation: slide-up 0.6s ease-out 0.2s both;
        }

        .category-breakdown {
            display: grid;
            gap: 24px;
            margin-bottom: 40px;
            animation: slide-up 0.6s ease-out 0.3s both;
        }

        .category {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(12px);
            padding: 28px;
            border-radius: 16px;
            border-left: 5px solid var(--primary);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .category:hover {
            transform: translateX(6px);
            box-shadow: var(--shadow-lg);
            background: rgba(255, 255, 255, 0.85);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }

        .category-name {
            font-weight: 800;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--gray-900);
        }

        .category-score {
            font-size: 1.5rem;
            font-weight: 900;
        }

        .progress-bar {
            background: rgba(0, 0, 0, 0.08);
            height: 12px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 14px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06) inset;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            transition: width 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2.5s infinite;
        }

        .issues-list {
            margin-top: 14px;
        }

        .issue {
            background: white;
            padding: 18px;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid var(--warning);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .issue:hover {
            box-shadow: var(--shadow-md);
            transform: translateX(4px);
        }

        .issue-title {
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.05rem;
        }

        .issue-description {
            font-size: 0.95rem;
            color: var(--gray-600);
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .issue-recommendation {
            font-size: 0.95rem;
            color: var(--primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-analysis {
            margin-top: 40px;
            animation: slide-up 0.6s ease-out 0.4s both;
        }

        .section-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(12px);
            padding: 26px;
            border-radius: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .section-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.85);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .section-title {
            font-weight: 800;
            font-size: 1.15rem;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--gray-900);
        }

        .section-status {
            padding: 8px 18px;
            border-radius: 24px;
            font-size: 0.85rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.7px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-good {
            background: rgba(16, 185, 129, 0.15);
            color: #047857;
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.15);
            color: #B45309;
        }

        .status-poor {
            background: rgba(239, 68, 68, 0.15);
            color: #991B1B;
        }

        .keyword-analysis {
            margin-top: 40px;
            animation: slide-up 0.6s ease-out 0.5s both;
        }

        .keyword-section {
            margin-bottom: 32px;
        }

        .keyword-section h3 {
            font-size: 1.3rem;
            margin-bottom: 18px;
            color: var(--gray-900);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .keyword-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .keyword-tag {
            padding: 12px 20px;
            border-radius: 24px;
            font-size: 0.95rem;
            font-weight: 700;
            transition: all 0.3s ease;
            cursor: default;
        }

        .keyword-tag:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .keyword-matched {
            background: rgba(16, 185, 129, 0.15);
            color: #047857;
            border: 2px solid rgba(16, 185, 129, 0.3);
        }

        .keyword-missing {
            background: rgba(239, 68, 68, 0.15);
            color: #991B1B;
            border: 2px solid rgba(239, 68, 68, 0.3);
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            margin-top: 40px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.25);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .job-description-section {
            margin-top: 32px;
            padding: 32px;
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 2px solid rgba(255, 255, 255, 0.4);
        }

        .job-description-section h3 {
            margin-bottom: 18px;
            color: var(--gray-900);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.15rem;
        }

        textarea {
            width: 100%;
            padding: 18px;
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 12px;
            font-family: inherit;
            font-size: 0.95rem;
            resize: vertical;
            min-height: 150px;
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            color: var(--gray-900);
            font-weight: 500;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.12);
            background: rgba(255, 255, 255, 0.98);
        }

        .tip-box {
            background: rgba(37, 99, 235, 0.1);
            border-left: 5px solid var(--primary);
            padding: 28px;
            border-radius: 16px;
            margin-top: 32px;
            backdrop-filter: blur(10px);
            animation: slide-up 0.6s ease-out 0.6s both;
        }

        .tip-box h4 {
            color: var(--primary);
            margin-bottom: 18px;
            font-size: 1.3rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .tip-list {
            list-style: none;
            padding-left: 0;
        }

        .tip-list li {
            padding: 12px 0;
            padding-left: 36px;
            position: relative;
            color: var(--gray-800);
            line-height: 1.7;
            font-weight: 500;
        }

        .tip-list li::before {
            content: '✓';
            position: absolute;
            left: 0;
            top: 12px;
            width: 24px;
            height: 24px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 900;
            font-size: 0.85rem;
        }

        .chart-container {
            margin: 32px 0;
            padding: 28px;
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
        }

        .chart-container h3 {
            margin-bottom: 22px;
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .ai-analysis-section {
            margin-top: 32px;
            padding: 32px;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.12) 0%, rgba(139, 92, 246, 0.12) 100%);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            border: 2px solid rgba(37, 99, 235, 0.35);
            animation: slide-up 0.6s ease-out 0.7s both;
        }

        .ai-analysis-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 22px;
        }

        .ai-analysis-header h3 {
            font-size: 1.4rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .ai-badge {
            padding: 6px 14px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 14px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .ai-content {
            background: rgba(255, 255, 255, 0.75);
            padding: 24px;
            border-radius: 14px;
            line-height: 1.9;
            color: var(--gray-800);
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .ai-loading {
            display: flex;
            align-items: center;
            gap: 14px;
            color: var(--gray-700);
            font-weight: 600;
        }

        .ai-loading-dots {
            display: flex;
            gap: 7px;
        }

        .ai-loading-dot {
            width: 9px;
            height: 9px;
            background: var(--primary);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .ai-loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .ai-loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }

            .card {
                padding: 28px;
            }

            .score-circle-container {
                width: 200px;
                height: 200px;
            }

            .score-circle {
                width: 200px;
                height: 200px;
            }

            .score-circle::before {
                width: 170px;
                height: 170px;
            }

            .score-value {
                font-size: 3.2rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        .hidden {
            display: none;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.12);
            color: #991B1B;
            padding: 22px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            border-left: 5px solid var(--danger);
            display: flex;
            align-items: center;
            gap: 14px;
            backdrop-filter: blur(10px);
            font-weight: 600;
        }

        @media print {
            body {
                background: white;
            }
            .action-buttons {
                display: none;
            }
        }

        /* Enhanced Section Heading Styles */
        .section-heading {
            font-size: 1.6rem;
            font-weight: 800;
            margin-bottom: 24px;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 14px;
        }
    </style>
</head>
<body>
    <div class="background-pattern"></div>
    <div class="container">
        <header>
            <h1>
                <span class="header-icon"><i data-lucide="target" width="52" height="52"></i></span>
                ATS-Friendly CV Analyzer
            </h1>
            <p class="subtitle">Professional Resume Optimization with AI-Powered Insights</p>
        </header>

        <div class="card" id="uploadCard">
            <div class="error-message" id="errorMessage">
                <i data-lucide="alert-circle" width="26" height="26"></i>
                <span id="errorText"></span>
            </div>
            
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon-container">
                    <i data-lucide="file-up" width="84" height="84" stroke-width="1.5" color="#2563EB"></i>
                </div>
                <div class="upload-text">Drop your CV here or click to browse</div>
                <div class="upload-hint">Supports PDF and DOCX files (max 5MB)</div>
                <input type="file" id="fileInput" accept=".pdf,.docx">
            </div>

            <div class="job-description-section">
                <h3>
                    <i data-lucide="briefcase" width="26" height="26"></i>
                    Job Description (Highly Recommended)
                </h3>
                <textarea id="jobDescription" placeholder="Paste the complete job description here for accurate keyword matching and personalized AI recommendations...

Including the job description significantly improves keyword analysis accuracy!"></textarea>
            </div>

            <div style="text-align: center; margin-top: 36px;">
                <button class="btn" id="analyzeBtn" disabled>
                    <i data-lucide="sparkles" width="22" height="22"></i>
                    <span>Analyze CV with AI</span>
                </button>
            </div>
        </div>

        <div class="card processing" id="processingCard">
            <div class="spinner-container">
                <div class="spinner"></div>
                <div class="spinner-inner"></div>
            </div>
            <h3>Analyzing your CV with AI...</h3>
            <p class="processing-text">This may take a few moments</p>
        </div>

        <div class="results" id="resultsCard">
            <div class="card">
                <div class="score-circle-container">
                    <div class="score-circle" id="scoreCircle">
                        <div class="score-icon-bg">
                            <i data-lucide="award" width="36" height="36" color="#2563EB" opacity="0.3"></i>
                        </div>
                        <div class="score-value" id="scoreValue">0</div>
                        <div class="score-label">ATS Score</div>
                    </div>
                </div>
                <div class="score-rating" id="scoreRating"></div>

                <div class="chart-container">
                    <h3>
                        <i data-lucide="bar-chart-3" width="26" height="26"></i>
                        Performance Overview
                    </h3>
                    <canvas id="performanceChart" height="80"></canvas>
                </div>

                <div class="category-breakdown" id="categoryBreakdown"></div>

                <div class="ai-analysis-section" id="aiAnalysisSection">
                    <div class="ai-analysis-header">
                        <i data-lucide="sparkles" width="30" height="30" color="#2563EB"></i>
                        <h3>AI-Powered Career Insights</h3>
                        <span class="ai-badge">AI</span>
                    </div>
                    <div class="ai-content" id="aiAnalysisContent">
                        <div class="ai-loading">
                            <i data-lucide="cpu" width="22" height="22"></i>
                            <span>Generating personalized career insights...</span>
                            <div class="ai-loading-dots">
                                <div class="ai-loading-dot"></div>
                                <div class="ai-loading-dot"></div>
                                <div class="ai-loading-dot"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-analysis" id="sectionAnalysis">
                    <h2 class="section-heading">
                        <i data-lucide="layout" width="30" height="30"></i>
                        Section-by-Section Analysis
                    </h2>
                    <div id="sectionCards"></div>
                </div>

                <div class="keyword-analysis" id="keywordAnalysis">
                    <h2 class="section-heading">
                        <i data-lucide="key" width="30" height="30"></i>
                        Keyword Analysis
                    </h2>
                    <div id="keywordContent"></div>
                </div>

                <div class="tip-box">
                    <h4>
                        <i data-lucide="lightbulb" width="26" height="26"></i>
                        Quick Tips to Improve Your Score
                    </h4>
                    <ul class="tip-list" id="quickTips"></ul>
                </div>

                <div class="action-buttons">
                    <button class="btn" onclick="location.reload()">
                        <i data-lucide="refresh-cw" width="22" height="22"></i>
                        <span>Analyze Another CV</span>
                    </button>
                    <button class="btn btn-secondary" onclick="window.print()">
                        <i data-lucide="download" width="22" height="22"></i>
                        <span>Save Report</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // PDF.js configuration
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // State management
        const state = {
            file: null,
            jobDescription: '',
            parsedText: '',
            analysisResult: null
        };

        // Scoring algorithm weights
        const WEIGHTS = {
            formatting: 30,
            keywords: 30,
            structure: 15,
            readability: 15,
            parsing: 10
        };

        // ENHANCED: More comprehensive ATS keywords by category
        const COMMON_KEYWORDS = {
            technical: [
                'JavaScript', 'Python', 'Java', 'React', 'Node.js', 'SQL', 'AWS', 'Docker', 'Git', 'API', 
                'Agile', 'REST', 'TypeScript', 'MongoDB', 'PostgreSQL', 'Azure', 'Kubernetes', 'CI/CD',
                'HTML', 'CSS', 'Angular', 'Vue', 'GraphQL', 'Jenkins', 'Terraform', 'Linux', 'MySQL'
            ],
            soft_skills: [
                'leadership', 'communication', 'teamwork', 'problem-solving', 'analytical', 
                'project management', 'collaboration', 'adaptability', 'critical thinking',
                'strategic planning', 'time management', 'decision making', 'conflict resolution',
                'mentoring', 'negotiation', 'presentation', 'customer service', 'multitasking'
            ],
            action_verbs: [
                'developed', 'managed', 'led', 'implemented', 'designed', 'created', 'improved', 
                'optimized', 'launched', 'analyzed', 'streamlined', 'spearheaded', 'coordinated',
                'initiated', 'executed', 'delivered', 'architected', 'transformed', 'achieved'
            ]
        };

        // DOM elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const jobDescriptionInput = document.getElementById('jobDescription');
        const uploadCard = document.getElementById('uploadCard');
        const processingCard = document.getElementById('processingCard');
        const resultsCard = document.getElementById('resultsCard');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');

        // Event listeners
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', handleFileSelect);
        analyzeBtn.addEventListener('click', analyzeCV);
        jobDescriptionInput.addEventListener('input', (e) => {
            state.jobDescription = e.target.value;
        });

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        }

        function handleFile(file) {
            const validTypes = ['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            const maxSize = 5 * 1024 * 1024; // 5MB

            if (!validTypes.includes(file.type)) {
                showError('Please upload a PDF or DOCX file');
                return;
            }

            if (file.size > maxSize) {
                showError('File size must be less than 5MB');
                return;
            }

            state.file = file;
            analyzeBtn.disabled = false;
            uploadArea.querySelector('.upload-text').textContent = `Selected: ${file.name}`;
            hideError();
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.style.display = 'flex';
            lucide.createIcons();
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        async function analyzeCV() {
            if (!state.file) return;

            uploadCard.style.display = 'none';
            processingCard.style.display = 'block';

            try {
                if (state.file.type === 'application/pdf') {
                    await parsePDF(state.file);
                } else {
                    await parseDOCX(state.file);
                }

                const analysis = performAnalysis();
                state.analysisResult = analysis;

                displayResults(analysis);

                processingCard.style.display = 'none';
                resultsCard.style.display = 'block';

                animateScore(analysis.overallScore);
                
                // Generate AI insights
                generateAIInsights(analysis);

            } catch (error) {
                console.error('Analysis error:', error);
                showError('An error occurred during analysis. Please try again.');
                processingCard.style.display = 'none';
                uploadCard.style.display = 'block';
            }
        }

        async function parsePDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let text = '';

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                const pageText = content.items.map(item => item.str).join(' ');
                text += pageText + '\n';
            }

            state.parsedText = text;
        }

        async function parseDOCX(file) {
            const arrayBuffer = await file.arrayBuffer();
            const result = await mammoth.extractRawText({ arrayBuffer });
            state.parsedText = result.value;
        }

        function performAnalysis() {
            const text = state.parsedText;
            const jobDesc = state.jobDescription;

            const categoryScores = {
                formatting: 0,
                keywords: 0,
                structure: 0,
                readability: 0,
                parsing: 0
            };

            const issues = [];
            const sections = detectSections(text);

            const formattingResult = analyzeFormatting(text);
            categoryScores.formatting = formattingResult.score;
            issues.push(...formattingResult.issues);

            const keywordResult = analyzeKeywords(text, jobDesc);
            categoryScores.keywords = keywordResult.score;
            issues.push(...keywordResult.issues);

            const structureResult = analyzeStructure(sections, text);
            categoryScores.structure = structureResult.score;
            issues.push(...structureResult.issues);

            const readabilityResult = analyzeReadability(text);
            categoryScores.readability = readabilityResult.score;
            issues.push(...readabilityResult.issues);

            const parsingResult = analyzeParsingQuality(text);
            categoryScores.parsing = parsingResult.score;
            issues.push(...parsingResult.issues);

            const overallScore = Math.round(
                (categoryScores.formatting * WEIGHTS.formatting +
                 categoryScores.keywords * WEIGHTS.keywords +
                 categoryScores.structure * WEIGHTS.structure +
                 categoryScores.readability * WEIGHTS.readability +
                 categoryScores.parsing * WEIGHTS.parsing) / 100
            );

            return {
                overallScore,
                categoryScores,
                issues,
                sections,
                keywords: keywordResult.keywords,
                recommendations: generateRecommendations(issues, overallScore)
            };
        }

        function detectSections(text) {
            const sections = {
                contact: false,
                summary: false,
                experience: false,
                education: false,
                skills: false
            };

            const sectionKeywords = {
                contact: /contact|email|phone|address|linkedin|portfolio/i,
                summary: /summary|objective|profile|about|professional summary|career objective/i,
                experience: /experience|employment|work history|career|professional experience/i,
                education: /education|academic|degree|university|college|certification/i,
                skills: /skills|technical skills|competencies|expertise|proficiencies/i
            };

            for (const [section, regex] of Object.entries(sectionKeywords)) {
                sections[section] = regex.test(text);
            }

            return sections;
        }

        function analyzeFormatting(text) {
            let score = 100;
            const issues = [];

            if (/\t{2,}/.test(text) || /\|{2,}/.test(text)) {
                score -= 15;
                issues.push({
                    category: 'formatting',
                    severity: 'high',
                    title: 'Tables Detected',
                    description: 'Complex tables can confuse ATS systems and cause text to be read out of order',
                    recommendation: 'Replace tables with bullet points and clear text formatting'
                });
            }

            const specialChars = text.match(/[★☆●◆■]/g);
            if (specialChars && specialChars.length > 5) {
                score -= 10;
                issues.push({
                    category: 'formatting',
                    severity: 'medium',
                    title: 'Special Characters Detected',
                    description: 'Special characters and symbols may not be recognized by ATS',
                    recommendation: 'Use standard bullet points (•) or hyphens (-) instead'
                });
            }

            if (/\n{4,}/.test(text)) {
                score -= 5;
                issues.push({
                    category: 'formatting',
                    severity: 'low',
                    title: 'Excessive Spacing',
                    description: 'Large gaps in your resume may cause parsing issues',
                    recommendation: 'Use consistent single or double spacing between sections'
                });
            }

            return { score: Math.max(0, score), issues };
        }

        // ENHANCED: Better keyword extraction and matching
        function analyzeKeywords(text, jobDesc) {
            let score = 100;
            const issues = [];
            const keywords = {
                matched: [],
                missing: []
            };

            let targetKeywords = [];
            
            if (jobDesc && jobDesc.trim().length > 50) {
                // Extract keywords from job description with better algorithm
                targetKeywords = extractKeywordsAdvanced(jobDesc);
            } else {
                // Use expanded common keywords
                targetKeywords = [
                    ...COMMON_KEYWORDS.technical.slice(0, 15),
                    ...COMMON_KEYWORDS.soft_skills.slice(0, 10)
                ];
            }

            // Normalize text for better matching
            const textLower = text.toLowerCase();
            const textNormalized = textLower.replace(/[^\w\s]/g, ' ');
            
            targetKeywords.forEach(keyword => {
                const keywordNormalized = keyword.toLowerCase().replace(/[^\w\s]/g, ' ');
                
                // Check for exact match or word boundary match
                if (textNormalized.includes(keywordNormalized) || 
                    new RegExp(`\\b${keywordNormalized.replace(/\s+/g, '\\s+')}\\b`, 'i').test(textLower)) {
                    keywords.matched.push(keyword);
                } else {
                    keywords.missing.push(keyword);
                }
            });

            const matchRate = targetKeywords.length > 0 ? keywords.matched.length / targetKeywords.length : 0;
            score = Math.round(matchRate * 100);

            if (matchRate < 0.3) {
                issues.push({
                    category: 'keywords',
                    severity: 'high',
                    title: 'Low Keyword Match',
                    description: `Only ${Math.round(matchRate * 100)}% of relevant keywords found in your CV`,
                    recommendation: jobDesc ? 'Add more role-specific keywords from the job description' : 'Add a job description for better keyword analysis'
                });
            } else if (matchRate < 0.6) {
                issues.push({
                    category: 'keywords',
                    severity: 'medium',
                    title: 'Moderate Keyword Match',
                    description: `${Math.round(matchRate * 100)}% keyword match - room for improvement`,
                    recommendation: 'Incorporate missing keywords naturally into your experience and skills'
                });
            }

            const keywordDensity = keywords.matched.length / text.split(/\s+/).length;
            if (keywordDensity > 0.05) {
                score -= 15;
                issues.push({
                    category: 'keywords',
                    severity: 'medium',
                    title: 'Possible Keyword Stuffing',
                    description: 'Excessive keyword usage may be flagged by ATS',
                    recommendation: 'Use keywords naturally and avoid repetition'
                });
            }

            return { score: Math.max(0, score), issues, keywords };
        }

        // ENHANCED: Better keyword extraction algorithm
        function extractKeywordsAdvanced(text) {
            // Remove common stop words
            const stopWords = new Set(['the', 'and', 'for', 'with', 'this', 'that', 'from', 'will', 'have', 
                                       'has', 'had', 'not', 'are', 'was', 'were', 'been', 'being', 'but',
                                       'such', 'must', 'can', 'may', 'should', 'would', 'could', 'also',
                                       'our', 'your', 'their', 'into', 'through', 'during', 'before', 'after']);
            
            const words = text.toLowerCase()
                .replace(/[^\w\s-]/g, ' ')
                .split(/\s+/)
                .filter(w => w.length > 2 && !stopWords.has(w));
            
            // Extract multi-word phrases (2-3 words)
            const phrases = [];
            for (let i = 0; i < words.length - 1; i++) {
                const twoWord = `${words[i]} ${words[i+1]}`;
                if (twoWord.length > 6) phrases.push(twoWord);
                
                if (i < words.length - 2) {
                    const threeWord = `${words[i]} ${words[i+1]} ${words[i+2]}`;
                    if (threeWord.length > 10) phrases.push(threeWord);
                }
            }
            
            // Count frequency
            const frequency = {};
            [...words, ...phrases].forEach(word => {
                frequency[word] = (frequency[word] || 0) + 1;
            });

            // Return top keywords/phrases
            return Object.entries(frequency)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 25)
                .map(([word]) => word);
        }

        function analyzeStructure(sections, text) {
            let score = 100;
            const issues = [];

            const requiredSections = ['experience', 'education', 'skills'];
            const missingSections = requiredSections.filter(s => !sections[s]);

            if (missingSections.length > 0) {
                score -= missingSections.length * 20;
                issues.push({
                    category: 'structure',
                    severity: 'high',
                    title: 'Missing Required Sections',
                    description: `Missing sections: ${missingSections.join(', ')}`,
                    recommendation: 'Add standard sections with clear headings'
                });
            }

            if (!sections.contact && !/\b[\w.-]+@[\w.-]+\.\w+\b/.test(text)) {
                score -= 15;
                issues.push({
                    category: 'structure',
                    severity: 'medium',
                    title: 'Contact Information Missing or Unclear',
                    description: 'ATS needs to easily identify your contact details',
                    recommendation: 'Include email and phone number at the top of your resume'
                });
            }

            return { score: Math.max(0, score), issues };
        }

        function analyzeReadability(text) {
            let score = 100;
            const issues = [];

            const bulletPoints = (text.match(/[•\-\*●]/g) || []).length;
            if (bulletPoints < 5) {
                score -= 20;
                issues.push({
                    category: 'readability',
                    severity: 'medium',
                    title: 'Limited Use of Bullet Points',
                    description: 'Bullet points improve readability and ATS parsing',
                    recommendation: 'Use bullet points to list achievements and responsibilities'
                });
            }

            const actionVerbCount = COMMON_KEYWORDS.action_verbs.filter(verb => 
                new RegExp(`\\b${verb}\\b`, 'i').test(text)
            ).length;
            
            if (actionVerbCount < 3) {
                score -= 15;
                issues.push({
                    category: 'readability',
                    severity: 'medium',
                    title: 'Few Action Verbs',
                    description: 'Action verbs strengthen your experience descriptions',
                    recommendation: 'Start bullet points with strong action verbs like "developed", "led", "implemented"'
                });
            }

            const numbers = text.match(/\d+%|\$\d+|(\d+\+)|\d+k/gi);
            if (!numbers || numbers.length < 3) {
                score -= 10;
                issues.push({
                    category: 'readability',
                    severity: 'low',
                    title: 'Limited Quantification',
                    description: 'Quantified achievements stand out to both ATS and recruiters',
                    recommendation: 'Add numbers and metrics to demonstrate impact (e.g., "Increased sales by 25%")'
                });
            }

            return { score: Math.max(0, score), issues };
        }

        function analyzeParsingQuality(text) {
            let score = 100;
            const issues = [];

            if (text.length < 500) {
                score -= 30;
                issues.push({
                    category: 'parsing',
                    severity: 'high',
                    title: 'Insufficient Content',
                    description: 'Your CV may be too short or have parsing issues',
                    recommendation: 'Ensure your CV has sufficient detail and is properly formatted'
                });
            }

            if (/[\uFFFD\x00-\x08\x0B\x0C\x0E-\x1F]/.test(text)) {
                score -= 15;
                issues.push({
                    category: 'parsing',
                    severity: 'medium',
                    title: 'Character Encoding Issues',
                    description: 'Some characters may not be recognized by ATS',
                    recommendation: 'Save your file with standard encoding (UTF-8)'
                });
            }

            return { score: Math.max(0, score), issues };
        }

        function generateRecommendations(issues, score) {
            const recommendations = [];

            if (score < 60) {
                recommendations.push('Major restructuring needed - focus on standard formatting first');
            } else if (score < 80) {
                recommendations.push('Good foundation - refine keywords and formatting for better results');
            } else {
                recommendations.push('Strong ATS compatibility - minor tweaks can push you to excellence');
            }

            const highSeverity = issues.filter(i => i.severity === 'high');
            if (highSeverity.length > 0) {
                recommendations.push(`Address ${highSeverity.length} critical issue(s) first`);
            }

            return recommendations;
        }

        // ENHANCED: Better AI insights generation
        async function generateAIInsights(analysis) {
            const aiContent = document.getElementById('aiAnalysisContent');
            
            try {
                // Create a more detailed prompt with context
                const prompt = `As an expert ATS specialist and career advisor, provide detailed, actionable insights for this CV analysis:

**Overall ATS Score:** ${analysis.overallScore}/100

**Category Performance:**
• Formatting & Layout: ${analysis.categoryScores.formatting}/100
• Keyword Optimization: ${analysis.categoryScores.keywords}/100
• Section Structure: ${analysis.categoryScores.structure}/100
• Readability & Clarity: ${analysis.categoryScores.readability}/100
• File Quality: ${analysis.categoryScores.parsing}/100

**Issues Identified:** ${analysis.issues.length} total issues
- High Priority: ${analysis.issues.filter(i => i.severity === 'high').length}
- Medium Priority: ${analysis.issues.filter(i => i.severity === 'medium').length}
- Low Priority: ${analysis.issues.filter(i => i.severity === 'low').length}

**Job Description:** ${state.jobDescription ? 'Provided ✓' : 'Not provided ✗'}

**Keywords Matched:** ${analysis.keywords.matched.length}/${analysis.keywords.matched.length + analysis.keywords.missing.length}

Please provide:
1. Executive summary of the CV's ATS readiness
2. Top 3-4 specific, actionable recommendations prioritized by impact
3. Concrete examples of how to implement each recommendation
4. Expected impact on ATS score for each change

Keep the tone professional, encouraging, and specific. Focus on the weakest areas first.`;

                const response = await fetch('/api/ai-insights', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        overallScore: analysis.overallScore,
                        categoryScores: analysis.categoryScores,
                        issuesCount: analysis.issues.length,
                        hasJobDescription: !!state.jobDescription
                    })
                });

                if (!response.ok) {
                    throw new Error('AI API request failed');
                }

                const data = await response.json();
                
                if (data.fallback) {
                    aiContent.innerHTML = `
                        <div style="display: flex; align-items: flex-start; gap: 14px; color: var(--gray-700);">
                            <i data-lucide="info" width="22" height="22" style="margin-top: 2px; flex-shrink: 0;"></i>
                            <div>
                                <p style="font-weight: 700; margin-bottom: 8px;">AI insights are temporarily unavailable.</p>
                                <p>Your comprehensive analysis is complete above with detailed scoring across all categories. Focus on the high-priority issues first for maximum impact.</p>
                            </div>
                        </div>
                    `;
                } else {
                    const aiInsights = data.content;
                    aiContent.innerHTML = `<div style="white-space: pre-wrap; line-height: 1.9;">${aiInsights}</div>`;
                }
                
                lucide.createIcons();
                
            } catch (error) {
                console.error('AI generation error:', error);
                aiContent.innerHTML = `
                    <div style="display: flex; align-items: flex-start; gap: 14px; color: var(--gray-700);">
                        <i data-lucide="info" width="22" height="22" style="margin-top: 2px; flex-shrink: 0;"></i>
                        <div>
                            <p style="font-weight: 700; margin-bottom: 8px;">AI insights are temporarily unavailable.</p>
                            <p>Your comprehensive analysis is complete above. Review the category breakdown and address high-priority issues first for best results.</p>
                        </div>
                    </div>
                `;
                lucide.createIcons();
            }
        }

        function displayResults(analysis) {
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreColor = getScoreColor(analysis.overallScore);
            scoreCircle.style.setProperty('--score', analysis.overallScore);
            scoreCircle.style.setProperty('--score-color', scoreColor);

            const ratingText = getRatingText(analysis.overallScore);
            const ratingIcon = getRatingIcon(analysis.overallScore);
            document.getElementById('scoreRating').innerHTML = `
                <i data-lucide="${ratingIcon}" width="36" height="36"></i>
                <span>${ratingText}</span>
            `;
            document.getElementById('scoreRating').style.color = scoreColor;

            createPerformanceChart(analysis.categoryScores);
            displayCategoryBreakdown(analysis);
            displaySectionAnalysis(analysis);
            displayKeywordAnalysis(analysis);
            displayQuickTips(analysis);

            lucide.createIcons();
        }

        function createPerformanceChart(categoryScores) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Formatting', 'Keywords', 'Structure', 'Readability', 'File Quality'],
                    datasets: [{
                        label: 'Score',
                        data: [
                            categoryScores.formatting,
                            categoryScores.keywords,
                            categoryScores.structure,
                            categoryScores.readability,
                            categoryScores.parsing
                        ],
                        backgroundColor: [
                            'rgba(37, 99, 235, 0.85)',
                            'rgba(16, 185, 129, 0.85)',
                            'rgba(245, 158, 11, 0.85)',
                            'rgba(139, 92, 246, 0.85)',
                            'rgba(239, 68, 68, 0.85)'
                        ],
                        borderColor: [
                            'rgba(37, 99, 235, 1)',
                            'rgba(16, 185, 129, 1)',
                            'rgba(245, 158, 11, 1)',
                            'rgba(139, 92, 246, 1)',
                            'rgba(239, 68, 68, 1)'
                        ],
                        borderWidth: 2,
                        borderRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 13
                            },
                            cornerRadius: 8
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                },
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.06)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        }
                    }
                }
            });
        }

        function displayCategoryBreakdown(analysis) {
            const container = document.getElementById('categoryBreakdown');
            container.innerHTML = '';

            const categories = [
                { key: 'formatting', name: 'Formatting & Layout', icon: 'layout', weight: WEIGHTS.formatting },
                { key: 'keywords', name: 'Keyword Optimization', icon: 'search', weight: WEIGHTS.keywords },
                { key: 'structure', name: 'Section Structure', icon: 'align-left', weight: WEIGHTS.structure },
                { key: 'readability', name: 'Readability & Clarity', icon: 'eye', weight: WEIGHTS.readability },
                { key: 'parsing', name: 'File Quality', icon: 'file-check', weight: WEIGHTS.parsing }
            ];

            categories.forEach(cat => {
                const score = analysis.categoryScores[cat.key];
                const categoryIssues = analysis.issues.filter(i => i.category === cat.key);
                
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                categoryDiv.style.borderLeftColor = getScoreColor(score);
                
                categoryDiv.innerHTML = `
                    <div class="category-header">
                        <div class="category-name">
                            <i data-lucide="${cat.icon}" width="22" height="22"></i>
                            ${cat.name}
                        </div>
                        <div class="category-score" style="color: ${getScoreColor(score)}">${score}/100</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${score}%; background: linear-gradient(90deg, ${getScoreColor(score)}, ${getScoreColor(score)}dd)"></div>
                    </div>
                    ${categoryIssues.length > 0 ? `
                        <div class="issues-list">
                            ${categoryIssues.map(issue => `
                                <div class="issue">
                                    <div class="issue-title">
                                        <i data-lucide="alert-triangle" width="18" height="18"></i>
                                        ${issue.title}
                                    </div>
                                    <div class="issue-description">${issue.description}</div>
                                    <div class="issue-recommendation">
                                        <i data-lucide="check-circle" width="18" height="18"></i>
                                        ${issue.recommendation}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<div style="color: var(--success); margin-top: 14px; font-weight: 700; display: flex; align-items: center; gap: 10px;"><i data-lucide="check-circle-2" width="20" height="20"></i> No issues detected - Excellent!</div>'}
                `;
                
                container.appendChild(categoryDiv);
            });

            lucide.createIcons();
        }

        function displaySectionAnalysis(analysis) {
            const container = document.getElementById('sectionCards');
            container.innerHTML = '';

            const sectionInfo = [
                { key: 'contact', name: 'Contact Information', icon: 'mail' },
                { key: 'summary', name: 'Professional Summary', icon: 'user' },
                { key: 'experience', name: 'Work Experience', icon: 'briefcase' },
                { key: 'education', name: 'Education', icon: 'graduation-cap' },
                { key: 'skills', name: 'Skills', icon: 'code' }
            ];

            sectionInfo.forEach(section => {
                const found = analysis.sections[section.key];
                const status = found ? 'good' : 'poor';
                const statusText = found ? 'Detected' : 'Missing';
                const statusIcon = found ? 'check-circle' : 'x-circle';
                
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section-card';
                
                sectionDiv.innerHTML = `
                    <div class="section-header">
                        <div class="section-title">
                            <i data-lucide="${section.icon}" width="22" height="22"></i>
                            ${section.name}
                        </div>
                        <div class="section-status status-${status}">
                            <i data-lucide="${statusIcon}" width="18" height="18"></i>
                            ${statusText}
                        </div>
                    </div>
                    ${!found && ['experience', 'education', 'skills'].includes(section.key) ? 
                        '<div style="color: var(--gray-600); font-size: 0.95rem; display: flex; align-items: center; gap: 10px; margin-top: 8px;"><i data-lucide="info" width="18" height="18"></i> This section is required for most ATS systems</div>' : ''}
                `;
                
                container.appendChild(sectionDiv);
            });

            lucide.createIcons();
        }

        function displayKeywordAnalysis(analysis) {
            const container = document.getElementById('keywordContent');
            
            if (analysis.keywords.matched.length === 0 && analysis.keywords.missing.length === 0) {
                container.innerHTML = `
                    <div style="padding: 24px; background: rgba(245, 158, 11, 0.1); border-radius: 12px; border-left: 4px solid var(--warning);">
                        <p style="color: var(--gray-800); display: flex; align-items: center; gap: 12px; font-weight: 600; font-size: 1.05rem;">
                            <i data-lucide="alert-circle" width="24" height="24" color="#F59E0B"></i>
                            <span>Add a job description for detailed keyword analysis</span>
                        </p>
                        <p style="color: var(--gray-600); margin-top: 12px; line-height: 1.6;">
                            Including the job description will provide accurate keyword matching and significantly improve your analysis quality.
                        </p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }

            container.innerHTML = `
                ${analysis.keywords.matched.length > 0 ? `
                    <div class="keyword-section">
                        <h3>
                            <i data-lucide="check-circle" width="26" height="26" color="#10B981"></i>
                            Matched Keywords (${analysis.keywords.matched.length})
                        </h3>
                        <div class="keyword-tags">
                            ${analysis.keywords.matched.slice(0, 20).map(kw => 
                                `<span class="keyword-tag keyword-matched">${kw}</span>`
                            ).join('')}
                        </div>
                    </div>
                ` : ''}
                
                ${analysis.keywords.missing.length > 0 ? `
                    <div class="keyword-section">
                        <h3>
                            <i data-lucide="alert-circle" width="26" height="26" color="#EF4444"></i>
                            Missing Keywords (${analysis.keywords.missing.length})
                        </h3>
                        <div class="keyword-tags">
                            ${analysis.keywords.missing.slice(0, 20).map(kw => 
                                `<span class="keyword-tag keyword-missing">${kw}</span>`
                            ).join('')}
                        </div>
                        <p style="color: var(--gray-600); margin-top: 18px; font-size: 0.95rem; display: flex; align-items: flex-start; gap: 10px; line-height: 1.7;">
                            <i data-lucide="lightbulb" width="20" height="20" style="margin-top: 2px; flex-shrink: 0;" color="#F59E0B"></i>
                            <span><strong>Pro Tip:</strong> Review these missing keywords and add relevant ones to your CV where they naturally fit your experience and skills.</span>
                        </p>
                    </div>
                ` : ''}
            `;

            lucide.createIcons();
        }

        function displayQuickTips(analysis) {
            const container = document.getElementById('quickTips');
            const tips = [];

            if (analysis.overallScore < 60) {
                tips.push('Use a simple, clean layout without tables or multi-column formats');
                tips.push('Include all standard section headings (Experience, Education, Skills, Contact)');
                tips.push('Save your CV as PDF or DOCX format for best compatibility');
            }

            if (analysis.categoryScores.keywords < 70) {
                tips.push('Add more keywords from the job description throughout your CV');
                tips.push('Use industry-standard terminology and technical skills');
                tips.push('Include both acronyms and full terms (e.g., "AI" and "Artificial Intelligence")');
            }

            if (analysis.categoryScores.readability < 80) {
                tips.push('Start each bullet point with strong action verbs (developed, led, implemented)');
                tips.push('Quantify your achievements with specific numbers and percentages');
                tips.push('Keep bullet points concise and focused on results');
            }

            if (analysis.categoryScores.formatting < 80) {
                tips.push('Remove tables, text boxes, headers, and footers');
                tips.push('Use standard fonts like Arial, Calibri, or Times New Roman');
                tips.push('Maintain consistent formatting throughout the document');
            }

            if (tips.length === 0) {
                tips.push('Your CV is well-optimized for ATS! Great job!');
                tips.push('Consider tailoring it specifically for each job application');
                tips.push('Keep it updated with your latest achievements and skills');
                tips.push('Have a trusted colleague review it for additional feedback');
            }

            container.innerHTML = tips.map(tip => `<li>${tip}</li>`).join('');
        }

        function getScoreColor(score) {
            if (score >= 80) return '#10B981';
            if (score >= 60) return '#F59E0B';
            return '#EF4444';
        }

        function getRatingText(score) {
            if (score >= 80) return 'Excellent - ATS-Optimized';
            if (score >= 60) return 'Good - Needs Improvement';
            return 'Needs Work - High Rejection Risk';
        }

        function getRatingIcon(score) {
            if (score >= 80) return 'award';
            if (score >= 60) return 'alert-triangle';
            return 'x-circle';
        }

        function animateScore(targetScore) {
            const scoreElement = document.getElementById('scoreValue');
            let currentScore = 0;
            const increment = targetScore / 60;
            const timer = setInterval(() => {
                currentScore += increment;
                if (currentScore >= targetScore) {
                    currentScore = targetScore;
                    clearInterval(timer);
                }
                scoreElement.textContent = Math.round(currentScore);
            }, 16);
        }
    </script>
</body>
</html>
